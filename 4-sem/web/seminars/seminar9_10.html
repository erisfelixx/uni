<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Кошик</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"> <!--іконки-->

    <style>
        body {
            background-color: #f8f9fa;
            color: darkslategray;
            font-family: 'Segoe UI', Tahoma, Verdana, sans-serif;
            font-weight: bold;
        }
        .container {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-top: 2rem;
            margin-bottom: 2rem;
        }
        h1 {
            color: #2f569f;
            font-weight: 700;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }
        .btn-primary {
            background-color: #2f569f;
            border-color: #2f569f;
        }
        .highlighted-section {
            background-color: #e9e9f3;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .price1-section {
            background-color: #e0e1e3;
            border-radius: 0.5rem;
            padding: 0.75rem;
            margin-top: 0.5rem;
        }
        .price2-section {
            background-color: #e8f5e9;
            border-radius: 0.5rem;
            padding: 0.75rem;
        }
        #booksCost, #totalCost {
            background-color: #f8f9fa;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            display: inline-block;
        }
        .section-header {
            margin-bottom: 1rem;
            font-weight: 600;
            color: #2f569f;
        }
        #orderSummary {
            background-color: #f8f9fa;
            border-left: 5px solid #2a9e34;
        }
    </style>
</head>


<body>
  <div class="container py-4">
    <h1 class="mb-4 text-center"><i class="fas fa-book me-2"></i>Замовлення на придбання товару</h1>

    <!-- вибір книги і кількості -->
    <div class="highlighted-section row g-3 mb-4 align-items-end"> 
        <div class="col-md-6">
          <label for="bookSelect" class="form-label"><i class="fas fa-bookmark me-1"></i>Назва товару:</label>
          <select id="bookSelect" class="form-select">
            <option value="">Оберіть книгу</option>
            <option value="Місто" data-author="Валер'ян Підмогильний" data-price="350">
            Місто (Валер'ян Підмогильний) – 350 грн.
            </option>
            <option value="Я (Романтика)" data-author="Микола Хвильовий" data-price="210">
            Я (Романтика) (Микола Хвильовий) - 210 грн.
            </option>
            <option value="Тигролови" data-author="Іван Багряний" data-price="290">
            Тигролови (Іван Багряний) - 290 грн.
            </option>
            <option value="Різдвяна пісня у прозі" data-author="Чарльз Діккенс" data-price="380">
            Різдвяна пісня у прозі (Чарльз Діккенс) - 380 грн.
            </option>
            <option value="За лаштунками імперії" data-author="Віра Агєєва" data-price="440">
            За лаштунками імперії (Віра Агєєва) - 440 грн.
            </option>
            <option value="Три товариші" data-author="Еріх Марія Ремарк" data-price="310">
            Три товариші (Еріх Марія Ремарк) - 310 грн.
            </option>
            <option value="Лісова пісня" data-author="Леся Українка" data-price="270">
            Лісова пісня (Леся Українка) - 270 грн.
            </option>
            <option value="Перевтілення" data-author="Франц Кафка" data-price="330">
            Перевтілення (Франц Кафка) - 330 грн.
            </option>
            <option value="Звіяні вітром" data-author="Марґарет Мітчелл" data-price="370">
            Звіяні вітром (Марґарет Мітчелл) - 370 грн.
            </option>
            <option value="Мартін Іден" data-author="Джек Лондон" data-price="280">
            Мартін Іден (Джек Лондон) - 280 грн.
            </option>
          </select>
        </div>
        <div class="col-md-3">
          <label for="quantity" class="form-label">Кількість:</label>
          <input type="number" id="quantity" min="1" value="1" class="form-control">
        </div>
        <div class="col-md-3">
          <button id="addToCart" class="btn btn-primary w-100"><i class="fas fa-cart-plus me-1"></i>Додати до кошика</button>
        </div>
    </div>

    <div id="bookList" class="card mb-4 d-none">        <!--список обраних книг(приховано на початку) -->
        <div class="card-body">
          <h5 class="card-title"><i class="fas fa-shopping-basket me-2"></i>Обрані книги:</h5>
          <div id="selectedBooks" class="list-group">            </div>
        </div>
    </div>

    <div class="price1-section mb-4">
        <label class="form-label"><i class="fas fa-tags me-1"></i>Вартість замовлених книг:</label>
        <p id="booksCost" class="fs-5 fw-semibold">0 грн.</p>
    </div>

    <div class="highlighted-section mb-4">
        <label class="form-label d-block"><i class="fas fa-shipping-fast me-1"></i>Спосіб доставки:</label>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="delivery" id="post" value="post" checked>
          <label class="form-check-label" for="post">Поштою (+5%)</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="delivery" id="courier" value="courier">
          <label class="form-check-label" for="courier">Кур'єром (+15%)</label>
        </div>

      <div id="addressField" class="mt-3 d-none">
        <label for="address" class="form-label">Адреса доставки:</label>
        <input type="text" id="address" class="form-control" placeholder="Введіть вашу адресу: ">
      </div>

      <div class="form-check mt-3">
        <input class="form-check-input" type="checkbox" id="giftWrap">
        <label class="form-check-label" for="giftWrap">
          У святковій упаковці (+10% до вартості доставки)
        </label>
      </div>
    </div>

    <div class="mb-4">                    <!--промокод -->            
        <label for="promoCode" class="form-label"><i class="fas fa-ticket-alt me-1"></i>Промокод:</label>
        <div class="input-group">
          <input type="text" id="promoCode" class="form-control" placeholder="Введіть промокод">
          <button id="applyPromo" class="btn btn-outline-secondary">Застосувати</button>
        </div>
        <div id="promoMessage" class="form-text text-danger d-none"></div>
    </div>

    <div class="price2-section mb-4">          <!-- загальна вартість -->
        <label class="form-label d-block"><i class="fas fa-money-bill-wave me-1"></i>Загальна вартість замовлення:</label>
        <p id="totalCost" class="fs-4 fw-bold">0 грн.</p>
        <button id="calculateTotal" class="btn btn-success">Підрахувати</button>
    </div>

    <!--дані покупця -->
    <h5 class="section-header"><i class="fas fa-user me-1"></i>Особисті дані</h5>
    <div class="row g-3 mb-4">
        <div class="col-md-4">
            <label for="firstName" class="form-label">Ім'я:</label>
            <input type="text" id="firstName" class="form-control" placeholder="Введіть ваше ім’я">
        </div>
        <div class="col-md-4">
            <label for="lastName" class="form-label">Прізвище:</label>
            <input type="text" id="lastName" class="form-control" placeholder="Введіть ваше прізвище">
        </div>
        <div class="col-md-4">
            <label for="phone" class="form-label">Телефон:</label>
           <input type="text" id="phone" class="form-control" placeholder="+38 (0XX) XXX XX XX">
           <div id="phoneError" class="form-text text-danger d-none">
            Неправильний формат: +38 (0XX) XXX XX XX
            </div>
        </div>
    </div>

    <div class="d-flex gap-2 mb-5">
        <button id="resetForm" class="btn btn-danger"><i class="fas fa-undo me-1"></i>Відновити початкові значення</button>
        <button id="submitOrder" class="btn btn-primary flex-grow-1">Відіслати дані</button>
    </div>

    <!--підсумок замовлення -->
    <div id="orderSummary" class="card d-none">
        <div class="card-body" id="orderSummaryContent"></div>
    </div>
  </div>



  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {       //всі айдішки
      const bookSelect = document.getElementById('bookSelect');
      const quantity = document.getElementById('quantity');
      const booksCost = document.getElementById('booksCost');
      const totalCost = document.getElementById('totalCost');
      const addToCartBtn = document.getElementById('addToCart');
      const bookList = document.getElementById('bookList');
      const selectedBooks = document.getElementById('selectedBooks');
      const postRadio = document.getElementById('post');
      const courierRadio = document.getElementById('courier');
      const addressField = document.getElementById('addressField');
      const giftWrapCheckbox = document.getElementById('giftWrap');
      const promoCodeInput = document.getElementById('promoCode');
      const applyPromoBtn = document.getElementById('applyPromo');
      const promoMessage = document.getElementById('promoMessage');
      const calculateTotalBtn = document.getElementById('calculateTotal');
      const firstName = document.getElementById('firstName');
      const lastName = document.getElementById('lastName');
      const phone = document.getElementById('phone');
      const phoneError = document.getElementById('phoneError');
      const resetFormBtn = document.getElementById('resetForm');
      const submitOrderBtn = document.getElementById('submitOrder');
      const orderSummary = document.getElementById('orderSummary');
      const orderSummaryContent = document.getElementById('orderSummaryContent');

      let cart = [];               // масив об’єктів title, author, price, quantity
      let appliedPromoCode = null;
      let appliedDiscount = 0;

      const promoCodes = {
        'MAY': 10,
        'SUMMER': 20,
        'WELCOMEBACK': 15,
        'FIRSTODER': 5,
        'READERLOVER': 12
      };

      addToCartBtn.addEventListener('click', addToCart);            //обробники подій
      courierRadio.addEventListener('change', toggleAddressField);
      postRadio.addEventListener('change', toggleAddressField);
      applyPromoBtn.addEventListener('click', applyPromoCode);
      calculateTotalBtn.addEventListener('click', calculateTotal);
      resetFormBtn.addEventListener('click', resetForm);
      submitOrderBtn.addEventListener('click', submitOrder);
      phone.addEventListener('input', validatePhone);

      phone.addEventListener('input', formatPhone);

      function formatPhone(e) {          //номер тф у форматі +38 (0XX) XXX XX XX
        let v = e.target.value.replace(/\D/g, '');
        if (v.length > 0) {
          if (v.length <= 2) v = '+' + v;
          else if (v.length <= 5) v = '+' + v.slice(0,2) + ' (' + v.slice(2);
          else if (v.length <= 8) v = '+' + v.slice(0,2) + ' (' + v.slice(2,5) + ') ' + v.slice(5);
          else if (v.length <= 10) v = '+' + v.slice(0,2) + ' (' + v.slice(2,5) + ') ' + v.slice(5,8) + ' ' + v.slice(8);
          else v = '+' + v.slice(0,2) + ' (' + v.slice(2,5) + ') ' + v.slice(5,8) + ' ' + v.slice(8,10) + ' ' + v.slice(10,12);
        }
        e.target.value = v;
      }

      function addToCart() {         //додає обрану книгу в масив cart і оновлює відображення.
        const opt = bookSelect.options[bookSelect.selectedIndex];
        if (!bookSelect.value) { alert('Оберіть книгу'); return; }
        const title = bookSelect.value;
        const author = opt.dataset.author;
        const price = parseFloat(opt.dataset.price);
        const qty = parseInt(quantity.value);
        if (qty < 1 || isNaN(qty)) { alert('Введіть дійсну кількість'); return; }

        const idx = cart.findIndex(b => b.title === title);
        if (idx > -1) cart[idx].quantity += qty;
        else cart.push({ title, author, price, quantity: qty });

        renderCart();
        bookSelect.selectedIndex = 0;
        quantity.value = 1;
      }

      function renderCart() {       //створення HTML-елементи для кожної книги в cart -> додає їх у список.
        selectedBooks.innerHTML = '';
        cart.forEach((b,i) => {
          const item = document.createElement('div');
          item.className = 'list-group-item d-flex justify-content-between align-items-center';
          item.innerHTML = `
            <div>
              <strong>${b.title}</strong> (${b.author})<br>
              ${b.price} грн. × ${b.quantity} = ${(b.price*b.quantity).toFixed(2)} грн.
            </div>
            <button class="btn btn-sm btn-outline-danger" data-i="${i}">✕</button>
          `;
          item.querySelector('button').onclick = () => {
            cart.splice(i,1);
            renderCart();
          };
          selectedBooks.append(item);
        });

        bookList.classList.toggle('d-none', cart.length===0);
        updateBooksCost();
      }

      function updateBooksCost() {
        const sum = cart.reduce((s,b)=>s + b.price*b.quantity,0);
        booksCost.textContent = sum.toFixed(2) + ' грн.';
        calculateTotal();
      }

      function toggleAddressField() {    //показ/приховання для поля у опції "кур'єр"
        addressField.classList.toggle('d-none', !courierRadio.checked);
        calculateTotal();
      }

      function applyPromoCode() {
        const c = promoCodeInput.value.trim().toUpperCase();
        if (!c) { showPromo('Введіть промокод','danger'); return; }
        if (promoCodes[c]) {
          appliedPromoCode = c;
          appliedDiscount = promoCodes[c];
          showPromo(`Промокод застосовано! Знижка ${appliedDiscount}%`,'success');
        } else {
          appliedPromoCode = null;
          appliedDiscount = 0;
          showPromo('Недійсний промокод','danger');
        }
        calculateTotal();
      }

      function showPromo(msg, type) {
        promoMessage.textContent = msg;
        promoMessage.className = `form-text text-${type}`;
        promoMessage.classList.remove('d-none');
        setTimeout(()=>promoMessage.classList.add('d-none'),3000);
      }

      function calculateTotal() {
        let total = cart.reduce((s,b)=>s + b.price*b.quantity,0);
        total *= postRadio.checked ? 1.05 : 1.15;
        if (giftWrapCheckbox.checked) total *= 1.10;
        if (appliedDiscount) total *= (1 - appliedDiscount/100);
        totalCost.textContent = total.toFixed(2) + ' грн.';
      }

      function validatePhone() {
        const ok = /^\+38 \(\d{3}\) \d{3} \d{2} \d{2}$/.test(phone.value);
        phoneError.classList.toggle('d-none', ok || !phone.value);
        return ok;
      }

      function resetForm() {
        cart = []; appliedPromoCode = null; appliedDiscount = 0;
        bookSelect.selectedIndex=0; quantity.value=1;
        postRadio.checked=true; courierRadio.checked=false;
        addressField.classList.add('d-none'); addressField.querySelector('input').value='';
        giftWrapCheckbox.checked=false;
        promoCodeInput.value=''; promoMessage.classList.add('d-none');
        firstName.value=''; lastName.value=''; phone.value=''; phoneError.classList.add('d-none');
        renderCart(); totalCost.textContent='0 грн.'; orderSummary.classList.add('d-none');
      }

      function submitOrder() {
        if (!cart.length) { alert('Додайте хоча б одну книгу'); return; }
        if (!firstName.value.trim()) { alert('Введіть ім’я'); firstName.focus(); return; }
        if (!lastName.value.trim()) { alert('Введіть прізвище'); lastName.focus(); return; }
        if (!validatePhone()) { alert('Неправильний телефон'); phone.focus(); return; }
        if (courierRadio.checked && !addressField.querySelector('input').value.trim()) {
          alert('Введіть адресу'); addressField.querySelector('input').focus(); return;
        }

        let subtotal = cart.reduce((s,b)=>s + b.price*b.quantity,0);  //розрахунок subtotal, deliveryFee, giftFee, discountAmount, grandTotal
        let deliveryFee = subtotal * (postRadio.checked ? 0.05 : 0.15);
        let giftFee = giftWrapCheckbox.checked ? (subtotal + deliveryFee)*0.1 : 0;
        let discountAmount = appliedDiscount ? (subtotal + deliveryFee + giftFee)*(appliedDiscount/100) : 0;
        let grandTotal = subtotal + deliveryFee + giftFee - discountAmount;

        //HTML-підсумок з list-group
        let html = `
          <h4>Інформація про замовлення</h4>
          <ul class="list-group mb-3">
            ${cart.map(b=>`
              <li class="list-group-item d-flex justify-content-between">
                <div>${b.title} (${b.author}) × ${b.quantity}</div>
                <div>${(b.price*b.quantity).toFixed(2)} грн.</div>
              </li>
            `).join('')}
            <li class="list-group-item d-flex justify-content-between">
              <strong>Вартість книг:</strong><strong>${subtotal.toFixed(2)} грн.</strong>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <div>Доставка:</div><div>${deliveryFee.toFixed(2)} грн.</div>
            </li>
            ${giftWrapCheckbox.checked?`
            <li class="list-group-item d-flex justify-content-between">
              <div>Упаковка:</div><div>${giftFee.toFixed(2)} грн.</div>
            </li>`:''}
            ${appliedDiscount?`
            <li class="list-group-item d-flex justify-content-between">
              <div>Промокод (${appliedPromoCode}):</div><div>-${discountAmount.toFixed(2)} грн.</div>
            </li>`:''}
            <li class="list-group-item d-flex justify-content-between bg-light">
              <strong>Загальна вартість:</strong><strong>${grandTotal.toFixed(2)} грн.</strong>
            </li>
          </ul>
          <h5>Дані покупця</h5>
          <p>${firstName.value} ${lastName.value}<br>${phone.value}</p>
          ${courierRadio.checked?`<p>Адреса: ${addressField.querySelector('input').value}</p>`:''}
        `;
        orderSummaryContent.innerHTML = html;
        orderSummary.classList.remove('d-none');
        orderSummary.scrollIntoView({ behavior: 'smooth' });
      }
    });
  </script>
</body>
</html>
